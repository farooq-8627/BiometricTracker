<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Biometric Remote Work Analysis</title>
		<link rel="stylesheet" href="styles.css" />
		<!-- Google Fonts -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<!-- TensorFlow.js for ML processing -->
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
		<!-- Chart.js for data visualization -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Chart.js Annotation plugin for threshold lines -->
		<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
		<!-- Socket.io for real-time communication -->
		<script src="https://cdn.jsdelivr.net/npm/socket.io/4.4.1/socket.io.min.js"></script>
		<!-- Feather icons -->
		<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<!-- Face API - single library instance used throughout the application -->
		<script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
		<!-- AOS Animation library -->
		<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
		<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
		<!-- Centralized Face API Loader -->
		<script src="faceApiLoader.js"></script>
		<!-- Model downloader script -->
		<script src="downloadModels.js"></script>
	</head>
	<body>
		<div class="device-selector">
			<div class="home-header" data-aos="fade-down" data-aos-duration="1000">
				<h1>Biometric Remote Work Analysis</h1>
				<p class="subtitle">
					Advanced AI-driven metrics for monitoring cognitive engagement and
					emotional states
				</p>
				<div class="authors">
					<p>
						By: Shaik Akhib Usman, Pothireddy Charishma, Cherukuri Sirichandana,
						Shaik Umar Farooq
					</p>
					<p>Under the guidance of Prof. Debabrata Senapati</p>
					<p>Department of Computer Science & Engineering, SRM University-AP</p>
				</div>
			</div>

			<div class="home-content">
				<div class="content-card" data-aos="fade-up" data-aos-duration="1000">
					<div class="main-feature">
						<div class="feature-content">
							<h2>
								<span class="highlight">Unlocking</span> Cognitive Potential
							</h2>
							<p>
								Our advanced biometric tracking system uses cutting-edge AI to
								provide real-time insights into remote work engagement and
								productivity metrics.
							</p>
							<ul class="feature-list">
								<li class="animate-feature">
									<i data-feather="eye"></i> Precision eye movement tracking
								</li>
								<li class="animate-feature">
									<i data-feather="activity"></i> Real-time heart rate analysis
								</li>
								<li class="animate-feature">
									<i data-feather="bar-chart-2"></i> Emotional state evaluation
								</li>
							</ul>
							<div class="stats-section">
								<div class="stat-item">
									<div class="stat-number">98.7%</div>
									<div class="stat-label">Accuracy Rate</div>
								</div>
								<div class="stat-item">
									<div class="stat-number">35ms</div>
									<div class="stat-label">Response Time</div>
								</div>
								<div class="stat-item">
									<div class="stat-number">7+</div>
									<div class="stat-label">Emotional States</div>
								</div>
							</div>
						</div>
						<div class="feature-visual">
							<div class="visual-container">
								<div class="purple-spiral"></div>
								<i data-feather="eye" class="large-icon pulse-animation"></i>
							</div>
						</div>
					</div>
				</div>

				<div
					class="project-details"
					data-aos="fade-up"
					data-aos-duration="1000"
				>
					<h2>Project Framework</h2>
					<div class="details-grid">
						<div class="detail-card">
							<div class="card-icon"><i data-feather="target"></i></div>
							<h3>Objective</h3>
							<p>
								Develop a real-time monitoring system to analyze cognitive and
								emotional states in work-from-home environments, aiming to
								enhance focus and productivity.
							</p>
						</div>
						<div class="detail-card">
							<div class="card-icon"><i data-feather="layers"></i></div>
							<h3>Architecture</h3>
							<p>
								A three-component architecture: Tracker (data capture),
								Dashboard (analysis & visualization), and Communication Layer
								(real-time data exchange).
							</p>
						</div>
						<div class="detail-card">
							<div class="card-icon"><i data-feather="cpu"></i></div>
							<h3>Technology</h3>
							<p>
								Integrates computer vision, deep learning, and real-time data
								processing to track eye movements, estimate heart rate, and
								analyze facial expressions.
							</p>
						</div>
						<div class="detail-card">
							<div class="card-icon"><i data-feather="bar-chart-2"></i></div>
							<h3>Applications</h3>
							<p>
								Organizations can monitor engagement, provide timely support,
								identify focus patterns, and make data-driven decisions about
								remote work eligibility.
							</p>
						</div>
					</div>
				</div>

				<div
					class="system-workflow"
					data-aos="zoom-in"
					data-aos-duration="1000"
				>
					<h2>System Workflow</h2>
					<div class="workflow-diagram">
						<div class="workflow-step">
							<div class="step-number">1</div>
							<div class="step-icon"><i data-feather="camera"></i></div>
							<div class="step-description">
								<strong>Data Acquisition</strong><br />Captures facial video for
								eye tracking and emotion analysis
							</div>
						</div>
						<div class="workflow-arrow"><i data-feather="arrow-right"></i></div>
						<div class="workflow-step">
							<div class="step-number">2</div>
							<div class="step-icon"><i data-feather="cpu"></i></div>
							<div class="step-description">
								<strong>Real-time Processing</strong><br />Analyzes eye
								movements, heart rate, and emotional states
							</div>
						</div>
						<div class="workflow-arrow"><i data-feather="arrow-right"></i></div>
						<div class="workflow-step">
							<div class="step-number">3</div>
							<div class="step-icon"><i data-feather="trending-up"></i></div>
							<div class="step-description">
								<strong>Dashboard Visualization</strong><br />Displays metrics
								and insights for monitoring
							</div>
						</div>
						<div class="workflow-arrow"><i data-feather="arrow-right"></i></div>
						<div class="workflow-step">
							<div class="step-number">4</div>
							<div class="step-icon"><i data-feather="zap"></i></div>
							<div class="step-description">
								<strong>Actionable Insights</strong><br />Enables data-driven
								decisions and interventions
							</div>
						</div>
					</div>
				</div>

				<div
					class="device-selection"
					data-aos="fade-up"
					data-aos-duration="1000"
				>
					<h3>Select your device type to begin:</h3>
					<div class="button-container">
						<button id="mobile-btn" class="device-btn">
							<i data-feather="smartphone"></i>
							<span class="device-btn-text">Tracker</span>
						</button>
						<button id="laptop-btn" class="device-btn">
							<i data-feather="monitor"></i>
							<span class="device-btn-text">Dashboard</span>
						</button>
					</div>
				</div>

				<div class="home-footer">
					<p>
						Designed for organizations with remote employees to ensure
						engagement and productivity
					</p>
					<p class="copyright">
						© 2025 SRM University-AP, Department of Computer Science &
						Engineering
					</p>
				</div>
			</div>
		</div>

		<!-- Mobile Interface (hidden by default) -->
		<div id="tracker-interface" class="interface-container hidden">
			<div class="header">
				<h2>Tracker Data Collection</h2>
				<div id="connection-status" class="status not-connected">
					Not Connected
				</div>
			</div>

			<div class="video-container">
				<video id="camera-feed" autoplay playsinline></video>
				<canvas id="overlay-canvas"></canvas>
			</div>

			<div class="controls">
				<button id="toggle-camera" class="control-btn">
					<i data-feather="video"></i>
					Start Camera
				</button>
				<button id="toggle-tracking" class="control-btn" disabled>
					<i data-feather="eye"></i>
					Start Tracking
				</button>
				<button id="pair-device" class="control-btn">
					<i data-feather="link"></i>
					Pair with Dashboard
				</button>
				<button id="tracker-download-models" class="control-btn">
					<i data-feather="download-cloud"></i>
					Download Models
				</button>
			</div>

			<div id="biofeedback-panel" class="panel hidden">
				<h3>Biofeedback</h3>
				<div id="feedback-messages"></div>
			</div>

			<div id="pairing-panel" class="panel hidden">
				<h3>Available Dashboards</h3>
				<ul id="available-laptops"></ul>
			</div>

			<div class="metrics">
				<div class="metric-box">
					<h4>Heart Rate</h4>
					<div id="heart-rate-value">-- BPM</div>
				</div>
				<div class="metric-box">
					<h4>Eye Movement</h4>
					<div id="eye-status">Not tracking</div>
				</div>
			</div>
		</div>

		<!-- Laptop Interface (hidden by default) -->
		<div id="laptop-interface" class="interface-container hidden">
			<div class="header">
				<h2>Analytics Dashboard</h2>
				<div id="laptop-connection-status" class="status not-connected">
					Not Connected
				</div>
			</div>

			<div class="dashboard-layout">
				<div class="panel" id="eye-tracking-panel">
					<h3>Eye Tracking Analysis</h3>
					<div class="chart-container">
						<canvas id="eye-movement-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Blink Rate</h4>
							<div id="blink-rate">-- blinks/min</div>
						</div>
						<div class="metric-box">
							<h4>Blink Count</h4>
							<div id="blink-count">-- blinks</div>
						</div>
						<div class="metric-box">
							<h4>Gaze Duration</h4>
							<div id="gaze-duration">-- seconds</div>
						</div>
						<div class="metric-box">
							<h4>Fatigue Index</h4>
							<div id="fatigue-index">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="blink-detection-panel">
					<h3>Blink Detection</h3>
					<div id="blink-indicator" class="blink-indicator">BLINK</div>
					<div class="chart-container">
						<canvas id="blink-chart"></canvas>
					</div>
				</div>

				<div class="panel" id="eye-tracking-detail-panel">
					<h3>Live Eye Tracking Visualization</h3>
					<div class="visualization-container">
						<canvas id="eye-tracking-viz" width="400" height="300"></canvas>
					</div>
					<div class="eye-metrics-grid">
						<div class="metric-box">
							<h4>Gaze Direction</h4>
							<div id="gaze-direction">x: --, y: --</div>
							<div id="gaze-text">Looking --</div>
						</div>
						<div class="metric-box">
							<h4>Pupil Diameter</h4>
							<div id="pupil-diameter">-- px (--)</div>
						</div>
						<div class="metric-box">
							<h4>Head Rotation</h4>
							<div id="head-rotation">P: --° Y: --° R: --°</div>
						</div>
						<div class="metric-box">
							<h4>Head Movement</h4>
							<div id="head-movement">x: --, y: --, z: --</div>
						</div>
					</div>
				</div>

				<div class="panel" id="heart-rate-panel">
					<h3>Heart Rate Monitoring</h3>
					<div class="chart-container">
						<canvas id="heart-rate-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Current</h4>
							<div id="current-hr">-- BPM</div>
						</div>
						<div class="metric-box">
							<h4>Average</h4>
							<div id="average-hr">-- BPM</div>
						</div>
						<div class="metric-box">
							<h4>Variability</h4>
							<div id="hr-variability">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="emotion-panel">
					<h3>Emotion Analysis</h3>
					<div class="chart-container">
						<canvas id="emotion-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Current Emotion</h4>
							<div id="current-emotion">--</div>
						</div>
						<div class="metric-box">
							<h4>Confidence</h4>
							<div id="emotion-confidence">--%</div>
						</div>
					</div>
				</div>

				<div class="panel" id="analytics-panel">
					<h3>Combined Analysis</h3>
					<div class="chart-container">
						<canvas id="combined-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Stress Level</h4>
							<div id="stress-level">--</div>
						</div>
						<div class="metric-box">
							<h4>Attention Score</h4>
							<div id="attention-score">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="connection-panel">
					<h3>Connected Devices</h3>
					<ul id="connected-devices"></ul>
					<div id="pairing-requests"></div>
					<h4>Available Tracker Devices</h4>
					<ul id="available-mobiles"></ul>
				</div>

				<div class="panel" id="feedback-panel">
					<h3>Send Biofeedback</h3>
					<div class="feedback-controls">
						<select id="feedback-type">
							<option value="alert">Alert</option>
							<option value="instruction">Instruction</option>
							<option value="status">Status Update</option>
						</select>
						<input
							type="text"
							id="feedback-message"
							placeholder="Enter feedback message"
						/>
						<button id="send-feedback" class="control-btn">Send</button>
					</div>
					<div class="feedback-history">
						<h4>Feedback History</h4>
						<ul id="feedback-history-list"></ul>
					</div>
				</div>
			</div>
		</div>

		<!-- Common Scripts -->
		<script src="utils.js"></script>
		<script src="webSocketUtils.js"></script>
		<script>
			// Make sure Socket.io is loaded and available
			if (typeof io === "undefined" && typeof window.io === "undefined") {
				console.log("Loading Socket.io dynamically");
				const socketScript = document.createElement("script");
				socketScript.src =
					"https://cdn.jsdelivr.net/npm/socket.io/4.4.1/socket.io.min.js";
				document.head.appendChild(socketScript);
			}
		</script>

		<!-- Load after Face API -->
		<script src="eyeTracking.js"></script>
		<script src="heartRateDetection.js"></script>

		<!-- Device Specific Scripts (loaded dynamically) -->

		<script>
			// Initialize Feather icons and AOS animations
			document.addEventListener("DOMContentLoaded", () => {
				// Initialize AOS animations
				AOS.init();

				// Add sequential animation to feature list
				const features = document.querySelectorAll(".animate-feature");
				features.forEach((feature, index) => {
					setTimeout(() => {
						feature.classList.add("animate-in");
					}, 500 + index * 300);
				});

				// Suppress TensorFlow warnings to avoid console clutter
				if (window.faceApiLoader) {
					window.faceApiLoader.suppressTensorflowWarnings();
				}

				// Check if feather is defined before using it
				if (typeof feather !== "undefined") {
					feather.replace();
				} else {
					console.error("Feather icons library not loaded");
					// Try to load it again
					const featherScript = document.createElement("script");
					featherScript.src =
						"https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js";
					featherScript.onload = () => feather.replace();
					document.head.appendChild(featherScript);
				}

				// Pre-initialize face-api to load models early
				if (window.faceApiLoader) {
					window.faceApiLoader.initializeFaceApi().then((success) => {
						console.log(
							"Face API pre-initialization " +
								(success ? "successful" : "failed")
						);
					});
				}

				// Setup mobile download button when interface is shown
				document.getElementById("mobile-btn").addEventListener("click", () => {
					// Once tracker interface is loaded, set up the model download button
					// to fetch all required ML models
					const trackerDownloadBtn = document.getElementById(
						"tracker-download-models"
					);
					if (trackerDownloadBtn) {
						trackerDownloadBtn.addEventListener("click", () => {
							loadFaceApiModels().then(() => {
								alert("Models downloaded successfully!");
							});
						});
					}
				});

				// Check if models need to be downloaded on first load
				setTimeout(() => {
					if (typeof checkModelsDownloadNeeded === "function") {
						checkModelsDownloadNeeded();
					}
				}, 2000);

				// Device selection
				document.getElementById("mobile-btn").addEventListener("click", () => {
					// Hide the device selector (home page)
					document.querySelector(".device-selector").classList.add("hidden");

					// Make sure all interface containers are hidden first
					document
						.querySelectorAll(".interface-container")
						.forEach((el) => el.classList.add("hidden"));

					// Then show only the tracker interface
					document
						.getElementById("tracker-interface")
						.classList.remove("hidden");

					// Dynamically load tracker script
					const trackerScript = document.createElement("script");
					trackerScript.src = "mobile.js";
					document.body.appendChild(trackerScript);

					trackerScript.onload = () => {
						initializeMobileInterface();
					};
				});

				document.getElementById("laptop-btn").addEventListener("click", () => {
					// Hide the device selector (home page)
					document.querySelector(".device-selector").classList.add("hidden");

					// Make sure all interface containers are hidden first
					document
						.querySelectorAll(".interface-container")
						.forEach((el) => el.classList.add("hidden"));

					// Then show only the laptop interface
					document
						.getElementById("laptop-interface")
						.classList.remove("hidden");

					// Dynamically load laptop script
					const laptopScript = document.createElement("script");
					laptopScript.src = "laptop.js";
					document.body.appendChild(laptopScript);

					laptopScript.onload = () => {
						initializeLaptopInterface();
					};
				});
			});
		</script>
	</body>
</html>
