<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Biometric Remote Work Analysis</title>
		<link rel="stylesheet" href="styles.css" />
		<!-- Google Fonts: Poppins -->
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<!-- Font Awesome Icons -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>
		<!-- TensorFlow.js for ML processing -->
		<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
		<!-- Chart.js for data visualization -->
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<!-- Chart.js Annotation plugin for threshold lines -->
		<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
		<!-- Socket.io for real-time communication -->
		<script src="https://cdn.jsdelivr.net/npm/socket.io/4.4.1/socket.io.min.js"></script>
		<!-- Feather icons -->
		<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<!-- Face API - single library instance used throughout the application -->
		<script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
		<!-- AOS Animation Library -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css"
		/>
		<!-- Centralized Face API Loader -->
		<script src="faceApiLoader.js"></script>
		<!-- Model downloader script -->
		<script src="downloadModels.js"></script>
	</head>
	<body>
		<!-- Device Selection - Modern Home Page Design -->
		<div id="device-selector" class="device-selector">
			<!-- Header Section -->
			<header class="home-header" data-aos="fade-in" data-aos-duration="1200">
				<h1>Biometric Remote Work Analysis</h1>
				<div class="subtitle">
					Explore the intersection of biometric tracking and remote work
					productivity with our innovative research system
				</div>
				<div class="authors">
					<p>A research project by the Computer Vision and AI Lab</p>
					<p>University of Science and Technology</p>
				</div>
			</header>

			<!-- Main Content -->
			<div class="home-content">
				<!-- Main Feature Card -->
				<div class="content-card" data-aos="fade-up" data-aos-duration="1000">
					<div class="main-feature">
						<div class="feature-content">
							<h2>
								<span class="highlight">AI-Powered</span> Biometric Analysis
							</h2>
							<p>
								Our system uses computer vision and machine learning to track
								and analyze biometric signals during remote work sessions,
								providing insights into productivity patterns, stress levels,
								and focus metrics.
							</p>
							<ul class="feature-list">
								<li class="animate-feature">
									<i class="fas fa-eye"></i> Eye movement tracking and analysis
								</li>
								<li class="animate-feature">
									<i class="fas fa-heartbeat"></i> Heart rate monitoring for
									stress detection
								</li>
								<li class="animate-feature">
									<i class="fas fa-brain"></i> Cognitive load assessment
								</li>
								<li class="animate-feature">
									<i class="fas fa-chart-line"></i> Real-time productivity
									metrics
								</li>
								<li class="animate-feature">
									<i class="fas fa-laptop-code"></i> Cross-device compatibility
								</li>
							</ul>
						</div>
						<div class="feature-visual">
							<div class="visual-container">
								<div class="biometric-visual">
									<!-- Brain wave representations -->
									<div class="brain-waves">
										<div class="wave-alpha"></div>
										<div class="wave-beta"></div>
										<div class="wave-theta"></div>
										<!-- Add second set of waves with different phases -->
										<div class="wave-alpha" style="animation-delay: 2s"></div>
										<div class="wave-beta" style="animation-delay: 2.5s"></div>
										<div class="wave-theta" style="animation-delay: 3s"></div>
									</div>

									<!-- Grid overlay -->
									<div class="grid-overlay"></div>

									<!-- Data points positioned at specific coordinates -->
									<div class="data-point" style="top: 30%; left: 20%"></div>
									<div class="data-point" style="top: 25%; left: 75%"></div>
									<div class="data-point" style="top: 70%; left: 30%"></div>
									<div class="data-point" style="top: 60%; left: 80%"></div>
									<div class="data-point" style="top: 45%; left: 55%"></div>
									<div class="data-point" style="top: 80%; left: 50%"></div>
									<!-- Add more data points with different animation offsets -->
									<div
										class="data-point"
										style="top: 40%; left: 40%; animation-delay: 1.5s"
									></div>
									<div
										class="data-point"
										style="top: 65%; left: 65%; animation-delay: 2.7s"
									></div>
									<div
										class="data-point"
										style="top: 20%; left: 50%; animation-delay: 1.2s"
									></div>
									<div
										class="data-point"
										style="top: 50%; left: 25%; animation-delay: 2.2s"
									></div>

									<!-- Pulse circle in the center -->
									<div class="pulse-circle"></div>

									<!-- ECG (Heart rate) line at the bottom -->
									<div class="ecg-container">
										<svg
											viewBox="0 0 300 60"
											xmlns="http://www.w3.org/2000/svg"
										>
											<path
												class="ecg-line"
												d="M0,30 Q25,30 50,30 T75,30 T100,30 L120,30 L130,10 L140,50 L150,30 L170,30 L180,20 L190,40 L200,30 L220,30 Q245,30 270,30 T300,30"
											/>
										</svg>
									</div>

									<!-- Iris container with pupil in the center -->
									<div class="iris-container">
										<div class="iris">
											<div class="pupil"></div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Project Framework -->
				<section class="project-details" data-aos="fade-up">
					<h2>Project Framework</h2>
					<div class="details-grid">
						<div class="detail-card" data-aos="fade-up" data-aos-delay="100">
							<div class="card-icon">
								<i class="fas fa-camera"></i>
							</div>
							<h3>Computer Vision</h3>
							<p>
								Utilizing advanced computer vision algorithms to detect and
								track facial features, eye movements, and micro-expressions for
								comprehensive biometric analysis.
							</p>
						</div>
						<div class="detail-card" data-aos="fade-up" data-aos-delay="200">
							<div class="card-icon">
								<i class="fas fa-robot"></i>
							</div>
							<h3>Machine Learning</h3>
							<p>
								Employing machine learning models trained on diverse datasets to
								identify patterns in biometric signals and correlate them with
								productivity metrics.
							</p>
						</div>
						<div class="detail-card" data-aos="fade-up" data-aos-delay="300">
							<div class="card-icon">
								<i class="fas fa-database"></i>
							</div>
							<h3>Data Analysis</h3>
							<p>
								Real-time processing and analysis of biometric data to provide
								actionable insights through intuitive visualizations and
								comprehensive dashboards.
							</p>
						</div>
					</div>
				</section>

				<!-- System Workflow -->
				<section class="system-workflow" data-aos="fade-up">
					<h2>System Workflow</h2>
					<div class="workflow-diagram">
						<div class="workflow-step" data-aos="fade-up" data-aos-delay="100">
							<div class="step-number">1</div>
							<div class="step-icon">
								<i class="fas fa-camera-retro"></i>
							</div>
							<div class="step-description">
								Camera captures facial features and eye movements during work
								sessions
							</div>
						</div>
						<div class="workflow-arrow" data-aos="fade-up" data-aos-delay="150">
							<i class="fas fa-chevron-right"></i>
						</div>
						<div class="workflow-step" data-aos="fade-up" data-aos-delay="200">
							<div class="step-number">2</div>
							<div class="step-icon">
								<i class="fas fa-heartbeat"></i>
							</div>
							<div class="step-description">
								Heart rate is measured using remote photoplethysmography (rPPG)
							</div>
						</div>
						<div class="workflow-arrow" data-aos="fade-up" data-aos-delay="250">
							<i class="fas fa-chevron-right"></i>
						</div>
						<div class="workflow-step" data-aos="fade-up" data-aos-delay="300">
							<div class="step-number">3</div>
							<div class="step-icon">
								<i class="fas fa-microchip"></i>
							</div>
							<div class="step-description">
								AI algorithms process and analyze the biometric data in
								real-time
							</div>
						</div>
						<div class="workflow-arrow" data-aos="fade-up" data-aos-delay="350">
							<i class="fas fa-chevron-right"></i>
						</div>
						<div class="workflow-step" data-aos="fade-up" data-aos-delay="400">
							<div class="step-number">4</div>
							<div class="step-icon">
								<i class="fas fa-chart-bar"></i>
							</div>
							<div class="step-description">
								Results are displayed on an interactive dashboard with
								actionable insights
							</div>
						</div>
					</div>
				</section>

				<!-- Device Selection -->
				<section class="device-selection" data-aos="fade-up">
					<h3>Select Your Device to Begin</h3>
					<div class="button-container">
						<!-- Preserve original IDs for functionality -->
						<button
							id="mobile-btn"
							class="device-btn"
							data-aos="fade-up"
							data-aos-delay="100"
						>
							<i class="fas fa-camera"></i>
							<span class="device-btn-text">Tracker</span>
						</button>
						<button
							id="laptop-btn"
							class="device-btn"
							data-aos="fade-up"
							data-aos-delay="200"
						>
							<i class="fas fa-chart-bar"></i>
							<span class="device-btn-text">Dashboard</span>
						</button>
					</div>
				</section>

				<!-- Footer -->
				<footer class="home-footer">
					<div>Biometric Remote Work Analysis - Research Project</div>
					<div class="copyright">
						© 2023 Computer Vision and AI Lab. All rights reserved.
					</div>
				</footer>
			</div>
		</div>

		<!-- Mobile Interface (hidden by default) -->
		<div id="mobile-interface" class="interface-container hidden">
			<div class="header">
				<h2>Tracker Data Collection</h2>
				<div id="connection-status" class="status not-connected">
					Not Connected
				</div>
			</div>

			<div class="video-container">
				<video id="camera-feed" autoplay playsinline></video>
				<canvas id="overlay-canvas"></canvas>
			</div>

			<div class="controls">
				<button id="toggle-camera" class="control-btn">
					<i data-feather="video"></i>
					Start Camera
				</button>
				<button id="toggle-tracking" class="control-btn" disabled>
					<i data-feather="eye"></i>
					Start Tracking
				</button>
				<button id="pair-device" class="control-btn">
					<i data-feather="link"></i>
					Pair with Dashboard
				</button>
				<button id="mobile-download-models" class="control-btn">
					<i data-feather="download-cloud"></i>
					Download Models
				</button>
			</div>

			<div id="biofeedback-panel" class="panel hidden">
				<h3>Biofeedback</h3>
				<div id="feedback-messages"></div>
			</div>

			<div id="pairing-panel" class="panel hidden">
				<h3>Available Dashboards</h3>
				<ul id="available-laptops"></ul>
			</div>

			<div class="metrics">
				<div class="metric-box">
					<h4>Heart Rate</h4>
					<div id="heart-rate-value">-- BPM</div>
				</div>
				<div class="metric-box">
					<h4>Eye Movement</h4>
					<div id="eye-status">Not tracking</div>
				</div>
			</div>
		</div>

		<!-- Laptop Interface (hidden by default) -->
		<div id="laptop-interface" class="interface-container hidden">
			<div class="header">
				<h2>Analytics Dashboard</h2>
				<div id="laptop-connection-status" class="status not-connected">
					Not Connected
				</div>
			</div>

			<div class="dashboard-layout">
				<div class="panel" id="eye-tracking-panel">
					<h3>Eye Tracking Analysis</h3>
					<div class="chart-container">
						<canvas id="eye-movement-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Blink Rate</h4>
							<div id="blink-rate">-- blinks/min</div>
						</div>
						<div class="metric-box">
							<h4>Blink Count</h4>
							<div id="blink-count">-- blinks</div>
						</div>
						<div class="metric-box">
							<h4>Gaze Duration</h4>
							<div id="gaze-duration">-- seconds</div>
						</div>
						<div class="metric-box">
							<h4>Fatigue Index</h4>
							<div id="fatigue-index">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="blink-detection-panel">
					<h3>Blink Detection</h3>
					<div id="blink-indicator" class="blink-indicator">BLINK</div>
					<div class="chart-container">
						<canvas id="blink-chart"></canvas>
					</div>
				</div>

				<div class="panel" id="eye-tracking-detail-panel">
					<h3>Live Eye Tracking Visualization</h3>
					<div class="visualization-container">
						<canvas id="eye-tracking-viz" width="400" height="300"></canvas>
					</div>
					<div class="eye-metrics-grid">
						<div class="metric-box">
							<h4>Gaze Direction</h4>
							<div id="gaze-direction">x: --, y: --</div>
							<div id="gaze-text">Looking --</div>
						</div>
						<div class="metric-box">
							<h4>Pupil Diameter</h4>
							<div id="pupil-diameter">-- px (--)</div>
						</div>
						<div class="metric-box">
							<h4>Head Rotation</h4>
							<div id="head-rotation">P: --° Y: --° R: --°</div>
						</div>
						<div class="metric-box">
							<h4>Head Movement</h4>
							<div id="head-movement">x: --, y: --, z: --</div>
						</div>
					</div>
				</div>

				<div class="panel" id="heart-rate-panel">
					<h3>Heart Rate Monitoring</h3>
					<div class="chart-container">
						<canvas id="heart-rate-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Current</h4>
							<div id="current-hr">-- BPM</div>
						</div>
						<div class="metric-box">
							<h4>Average</h4>
							<div id="average-hr">-- BPM</div>
						</div>
						<div class="metric-box">
							<h4>Variability</h4>
							<div id="hr-variability">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="emotion-panel">
					<h3>Emotion Analysis</h3>
					<div class="chart-container">
						<canvas id="emotion-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Current Emotion</h4>
							<div id="current-emotion">--</div>
						</div>
						<div class="metric-box">
							<h4>Confidence</h4>
							<div id="emotion-confidence">--%</div>
						</div>
					</div>
				</div>

				<div class="panel" id="analytics-panel">
					<h3>Combined Analysis</h3>
					<div class="chart-container">
						<canvas id="combined-chart"></canvas>
					</div>
					<div class="metrics-grid">
						<div class="metric-box">
							<h4>Stress Level</h4>
							<div id="stress-level">--</div>
						</div>
						<div class="metric-box">
							<h4>Attention Score</h4>
							<div id="attention-score">--</div>
						</div>
					</div>
				</div>

				<div class="panel" id="connection-panel">
					<h3>Connected Devices</h3>
					<ul id="connected-devices"></ul>
					<div id="pairing-requests"></div>
					<h4>Available Tracker Devices</h4>
					<ul id="available-mobiles"></ul>
				</div>

				<div class="panel" id="feedback-panel">
					<h3>Send Biofeedback</h3>
					<div class="feedback-controls">
						<select id="feedback-type">
							<option value="alert">Alert</option>
							<option value="instruction">Instruction</option>
							<option value="status">Status Update</option>
						</select>
						<input
							type="text"
							id="feedback-message"
							placeholder="Enter feedback message"
						/>
						<button id="send-feedback" class="control-btn">Send</button>
					</div>
					<div class="feedback-history">
						<h4>Feedback History</h4>
						<ul id="feedback-history-list"></ul>
					</div>
				</div>
			</div>
		</div>

		<!-- Common Scripts -->
		<script src="utils.js"></script>
		<script src="webSocketUtils.js"></script>

		<!-- Load after Face API -->
		<script src="eyeTracking.js"></script>
		<script src="heartRateDetection.js"></script>

		<!-- Device Specific Scripts (loaded dynamically) -->

		<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
		<script>
			// Initialize AOS animations
			AOS.init({
				once: true,
				offset: 100,
			});

			// Add scroll fix
			window.onload = function () {
				// Force browser to recalculate scroll position
				setTimeout(function () {
					window.scrollTo(0, 0);
					document.body.style.height = "auto";
					document.documentElement.style.height = "auto";
				}, 100);
			};

			// Feature list sequential animation
			document.addEventListener("DOMContentLoaded", function () {
				const features = document.querySelectorAll(".animate-feature");

				// Sequentially animate features with a delay
				features.forEach((feature, index) => {
					setTimeout(() => {
						feature.classList.add("animate-in");
					}, 1000 + index * 200); // Start after 1s, then 200ms between each
				});

				// Suppress TensorFlow warnings to avoid console clutter
				if (window.faceApiLoader) {
					window.faceApiLoader.suppressTensorflowWarnings();
				}

				// Pre-initialize face-api to load models early
				if (window.faceApiLoader) {
					window.faceApiLoader.initializeFaceApi().then((success) => {
						console.log(
							"Face API pre-initialization " +
								(success ? "successful" : "failed")
						);
					});
				}

				// Add download models button event listeners
				document
					.getElementById("download-models-btn")
					?.addEventListener("click", () => {
						if (typeof downloadFaceApiModels === "function") {
							downloadFaceApiModels();
						} else {
							alert(
								"Model download functionality not available. Please try again later."
							);
						}
					});

				// Check if models need to be downloaded on first load
				setTimeout(() => {
					if (typeof checkModelsDownloadNeeded === "function") {
						checkModelsDownloadNeeded();
					}
				}, 2000);

				// Device selection functionality
				const mobileBtn = document.getElementById("mobile-btn");
				const laptopBtn = document.getElementById("laptop-btn");
				const deviceSelector = document.getElementById("device-selector");
				const mobileInterface = document.getElementById("mobile-interface");
				const laptopInterface = document.getElementById("laptop-interface");

				// Mobile button click event handler (now Tracker)
				mobileBtn.addEventListener("click", function () {
					deviceSelector.classList.add("hidden");
					mobileInterface.classList.remove("hidden");

					// Dynamically load mobile script
					const mobileScript = document.createElement("script");
					mobileScript.src = "mobile.js";
					document.body.appendChild(mobileScript);

					mobileScript.onload = () => {
						if (typeof initializeMobileInterface === "function") {
							initializeMobileInterface();
						}
					};

					// Setup mobile download button
					setTimeout(() => {
						const mobileDownloadBtn = document.getElementById(
							"mobile-download-models"
						);
						if (mobileDownloadBtn) {
							mobileDownloadBtn.addEventListener("click", () => {
								if (typeof downloadFaceApiModels === "function") {
									downloadFaceApiModels();
								} else {
									alert(
										"Model download functionality not available. Please try again later."
									);
								}
							});
						}
					}, 500);
				});

				// Laptop button click event handler (now Dashboard)
				laptopBtn.addEventListener("click", function () {
					deviceSelector.classList.add("hidden");
					laptopInterface.classList.remove("hidden");

					// Dynamically load laptop script
					const laptopScript = document.createElement("script");
					laptopScript.src = "laptop.js";
					document.body.appendChild(laptopScript);

					laptopScript.onload = () => {
						if (typeof initializeLaptopInterface === "function") {
							initializeLaptopInterface();
						}
					};
				});
			});
		</script>
	</body>
</html>
